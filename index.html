<!DOCTYPE html>
<html lang="es">
<head>
    <style>
        /* ... tu <style> completo aquí (sin cambios) ... */
        /* ¡NUEVO ESTILO PARA EL FILTRO SELECT! */
        .filter-container {
            margin-bottom: 4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }
        #city-filter {
            background-color: var(--color-superficie);
            color: var(--color-texto-secundario);
            border: 1px solid var(--color-borde);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="search-wrapper">
            </div>
        
        <div class="filter-container">
            <label for="city-filter">O filtra por ciudad:</label>
            <select id="city-filter">
                <option value="">Todas</option>
                <option value="Madrid">Madrid</option>
                <option value="Sevilla">Sevilla</option>
                <option value="Jerez de la Frontera">Jerez</option>
                <option value="Barcelona">Barcelona</option>
                <option value="Granada">Granada</option>
                <option value="Córdoba">Córdoba</option>
            </select>
        </div>

        <div id="loadingMessage" style="display: none;"></div>
        <div id="resultsContainer"></div>
    </div>

    <footer>
        </footer>

    <script>
        const API_URL_BASE = 'https://duende-api.onrender.com/events';
        // ... tus otras constantes (sin cambios) ...
        const cityFilter = document.getElementById('city-filter'); // Nueva constante para el filtro

        // --- ¡NUEVA LÓGICA! Event listener para el filtro de ciudad ---
        cityFilter.addEventListener('change', () => {
            const selectedCity = cityFilter.value;
            if (selectedCity) {
                // Si se elige una ciudad, hacemos una búsqueda por ciudad
                performSearch({ city: selectedCity });
            } else {
                // Si se elige "Todas", volvemos a la vista inicial
                loadUpcomingEvents();
            }
        });

        // --- FUNCIÓN performSearch MODIFICADA ---
        // Ahora acepta un objeto para poder buscar por texto o por ciudad
        async function performSearch(searchParams) {
            loadingMessage.style.display = 'block';
            resultsContainer.innerHTML = '';
            let fullUrl = API_URL_BASE;

            if (searchParams.text) {
                fullUrl += `?search=${encodeURIComponent(searchParams.text)}`;
                searchInput.value = searchParams.text;
            } else if (searchParams.city) {
                fullUrl += `?city=${encodeURIComponent(searchParams.city)}`;
                searchInput.value = ''; // Limpiamos el buscador de texto
            } else {
                loadUpcomingEvents(); return;
            }
            
            try {
                const response = await fetch(fullUrl);
                if (!response.ok) throw new Error('La respuesta de la red no fue correcta');
                const events = await response.json();
                displayEvents(events);
            } catch (error) {
                resultsContainer.innerHTML = '<p>Hubo un error al realizar la búsqueda.</p>';
            } finally {
                loadingMessage.style.display = 'none';
            }
        }

        // Modificamos los listeners antiguos para que usen la nueva función
        searchButton.addEventListener('click', () => performSearch({ text: searchInput.value.trim() }));
        searchInput.addEventListener('keyup', (event) => { if (event.key === "Enter") { searchButton.click(); } });
        document.querySelectorAll('.quick-search-btn').forEach(button => {
            button.addEventListener('click', () => { performSearch({ text: button.dataset.search }); });
        });
        
        // El resto de tu script (loadUpcomingEvents, displayEvents, etc.) no necesita cambios
        // ...
    </script>
</body>
</html>