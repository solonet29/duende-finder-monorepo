### Resumen de la Sesión - 23 de octubre de 2025

**Objetivo Principal:** Solucionar un problema de caché que impedía que las imágenes de eventos recién creadas se mostraran en la web, mostrando en su lugar imágenes `placeholder`.

**Diagnóstico del Problema:**

1.  Se identificó que el problema no era del backend, ya que el pipeline de generación de imágenes funcionaba correctamente.
2.  La causa raíz era un sistema de **doble caché**:
    *   Una **caché local** en el navegador del usuario (`sessionStorage`) que guardaba los datos de los eventos durante 5 minutos.
    *   Una **caché de servidor** en la red de Vercel (`s-maxage=300`) que también guardaba los datos durante 5 minutos para todos los usuarios.
3.  Esta doble capa, especialmente la de Vercel al ser compartida, provocaba que los datos no se refrescaran incluso después de largos periodos de tiempo, ya que la caché del servidor se renovaba constantemente con el tráfico de otros usuarios.

**Solución Implementada:**

Se diseñó e implementó una solución robusta para equilibrar rendimiento y frescura de los datos:

1.  **Caché Larga (Rendimiento):** Se modificó `apps/api/vercel.json` para aumentar la duración de la caché de Vercel a **24 horas**. Esto mejorará significativamente el rendimiento para usuarios normales y los resultados de PageSpeed Insights.
2.  **Bypass Manual (Control):** Se creó un mecanismo de actualización manual:
    *   Se añadió un botón visible de **"Actualizar Datos"** en `apps/nuevo-buscador/index.html`.
    *   Se añadió una regla en `vercel.json` para que las peticiones con el parámetro `?refresh=true` ignoren la caché de Vercel.
    *   Se implementó la lógica en `apps/nuevo-buscador/script.js` para que el botón limpie la caché local del navegador y haga una petición con el parámetro `?refresh=true`, forzando una recarga completa de los datos.

**Tarea Secundaria (Memoria de Conversación):**

*   Para solucionar la falta de memoria entre sesiones, se creó una carpeta `.gemini_logs` en la raíz del proyecto.
*   Se añadió esta carpeta al `.gitignore` para que no sea incluida en los despliegues.
*   Se acordó guardar resúmenes de las sesiones en esta carpeta para poder recuperar el contexto en el futuro.

---

### Actualización - Optimización de Rendimiento y UI

**Problema Secundario:** Tras implementar la nueva estrategia de caché, la puntuación de PageSpeed Insights empeoró significativamente.

**Diagnóstico de Rendimiento:**

1.  **Carga de Recursos Ineficiente:** Se detectó una carga duplicada de fuentes y un uso incorrecto de `preload`, retrasando el renderizado.
2.  **CSS Crítico Vacío:** La etiqueta `<style id="critical-css">` estaba vacía, forzando al navegador a esperar la carga completa del CSS.
3.  **Falta de `preconnect`:** El informe de Lighthouse señaló la ausencia de una preconexión al dominio de la API (`api-v2.afland.es`), lo que añadía latencia a la primera petición de datos.

**Solución de Rendimiento Implementada:**

1.  **Optimización del `<head>`:** Se limpió `index.html` para usar un único método de carga de fuentes, se añadió el `preconnect` a la API y se inyectaron los estilos CSS críticos para el contenido "above-the-fold" directamente en el HTML.

**Mejora de UI (Feedback del Usuario):**

1.  **Problema:** El botón "Actualizar Datos" tenía un estilo de "chip de filtro" y no estaba centrado, perjudicando la experiencia en móviles.
2.  **Solución:** Se crearon estilos CSS específicos (`.refresh-btn`) y se modificó el HTML para transformar el elemento en un botón de acción principal, centrado y visualmente destacado, siguiendo un enfoque `mobile-first`.

---

### Actualización - Optimización de Rendimiento (CLS) y UI

**Objetivo:** Solucionar la caída de puntuación en PageSpeed Insights, específicamente los problemas de CLS (Cumulative Layout Shift) y atender una petición de cambio en la UI.

**Diagnóstico de Rendimiento:**
1.  **CLS (Cumulative Layout Shift):** El informe de PageSpeed indicaba un CLS alto (0.324) causado por el elemento `<main class="container">`. Se diagnosticó que esto ocurría porque el contenedor se renderizaba vacío y luego se le inyectaba dinámicamente el contenido de los eventos, provocando un salto brusco en el diseño.
2.  **UI/UX:** El usuario solicitó mover el botón de "Actualizar Datos" desde la cabecera a la barra de navegación inferior para mejorar la accesibilidad y el diseño.

**Solución Implementada:**
1.  **Mitigación de CLS:** Se añadió una regla CSS en `apps/nuevo-buscador/index.html` para establecer una altura mínima (`min-height: 100vh;`) al contenedor `<main class="container">`. Esto reserva el espacio vertical necesario desde la carga inicial, evitando el salto de diseño cuando el contenido es inyectado por JavaScript.
2.  **Reubicación del Botón de Recarga:**
    *   Se eliminó el botón "Actualizar Datos" de su contenedor en la sección de la cabecera del `index.html`.
    *   Se añadió un nuevo botón con el icono de recarga (`<ion-icon name="refresh-outline">`) en la barra de navegación inferior (`<nav id="bottom-nav">`), conservando el `id="force-refresh-btn"` para que la lógica JavaScript existente siguiera funcionando sin cambios.
