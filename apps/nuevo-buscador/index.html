<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
    <link rel="preload" as="image" href="/assets/img_header.webp" fetchpriority="high">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Conciertos Flamencos - Duende Finder</title>
    <meta name="description"
        content="Descubre la magia del flamenco. Busca conciertos, tablaos y festivales por todo el Mundo.">
    <meta property="og:image"
        content="https://www.afland.es/wp-content/uploads/2024/04/DUENDE-FINDER-LOGO-1200-X-630-PX.png">

    <link rel="preconnect" href="https://api-v2.afland.es" crossorigin>
    <link rel="preconnect" href="https://afland.es" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="/assets/index.css">

    <link rel="preload"
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap"
        as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap">
    </noscript>





    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link rel="manifest" href="/assets/manifest.json">
    <meta name="theme-color" content="#121212">

    <style id="critical-css"></style>
    <link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="styles.css">
    </noscript>
    <link rel="preload" href="chatbot.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="chatbot.css">
    </noscript>
    <style>
        .status-box {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1.5rem;
            border: 1px solid;
        }

        .status-box.granted {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .status-box.denied {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .status-box.default {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }

        .action-button-notifications {
            display: block;
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            background-color: var(--color-acento);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .action-button-notifications:hover {
            filter: brightness(1.1);
        }

        .action-button-notifications:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .instructions {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--color-texto-secundario);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <!-- Google tag (gtag.js) -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <script defer src="https://www.googletagmanager.com/gtag/js?id=G-0CDETYT85Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-0CDETYT85Z');
    </script>
</head>

<body>

    <div class="hero-header">
        <picture>
            <source media="(max-width: 768px)" srcset="/assets/img_header-mobile.webp">
            <source media="(min-width: 769px)" srcset="/assets/img_header.webp">
            <img src="/assets/img_header.webp" alt="Guitarrista flamenco en un escenario oscuro" class="hero-image"
                fetchpriority="high">
        </picture>
        <div class="hero-text">
            <h1 class="main-title">Duende Finder</h1>
            <p id="event-stats" class="hero-subtitle">Un proyecto de AFLand</p>
        </div>
    </div>

    <div id="welcome-modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-content welcome-modal-content">
                <div class="sponsor-container">
                    <p>Un proyecto de:</p>
                    <a id="sponsor-link" href="#" target="_blank" rel="noopener noreferrer"><img id="sponsor-logo"
                            src="" alt="Logo del Patrocinador" class="sponsor-logo"></a>
                </div>
                <div id="welcome-banner-container" class="banner-container hidden">
                    <a id="banner-link" href="#" target="_blank" rel="noopener noreferrer"><img id="banner-image" src=""
                            alt="Banner promocional" class="banner-image"></a>
                </div>
                <div class="loading-indicator">
                    <ion-icon name="flame-outline"></ion-icon>
                    <p>Cargando tablaos...</p>
                </div>
            </div>
        </div>
    </div>

    <header class="header-main">
        <div class="container">
            <nav class="filter-bar" id="main-filter-bar">
                <a href="#" class="filter-chip active" data-filter="proximos">Pr√≥ximos</a>
                <a href="#" class="filter-chip" data-filter="destacados">Destacados</a>
                <a href="#" class="filter-chip" data-filter="recientes">Reci√©n A√±adidos</a>
                <a href="#" class="filter-chip" data-filter="cerca">Cerca de M√≠</a>
                <button id="advanced-filter-toggle-btn" class="filter-chip">
                    M√°s Filtros <ion-icon name="options-outline"></ion-icon>
                </button>
            </nav>
            <div id="active-filters-container"></div>
        </div>
    </header>

    <div id="advanced-filter-panel" class="advanced-filter-panel" style="display: none;">
        <div class="container">
            <div class="filter-group">
                <label for="city-search-input">Buscar por Ciudad</label>
                <div class="search-input-wrapper">
                    <input type="text" id="city-search-input" placeholder="Escribe una ciudad y pulsa Enter..."
                        autocomplete="off">
                    <div id="city-autocomplete-results" class="autocomplete-results"></div>
                </div>
            </div>
        </div>
    </div>

    <main class="container">
        <!-- Search Actions -->
        <div class="main-actions-container">
            <form class="search-bar-container" id="header-search-form">
                <input type="text" id="header-search-input" class="search-input"
                    placeholder="Buscar artistas, ciudades, tablaos..."
                    aria-label="Buscar artistas, ciudades, tablaos...">
                <button type="submit" class="search-button">
                    <ion-icon name="search-outline"></ion-icon>
                </button>
            </form>
        </div>
        <!-- End Search Actions -->
        <section id="trip-planner-section" class="trip-planner-section" style="display: none;">
            <h2 id="trip-planner-toggle">
                Planificador de Viaje üó∫Ô∏è
                <ion-icon name="chevron-down-outline"></ion-icon>
            </h2>
            <div id="trip-planner-content" class="trip-planner-content">
                <div class="trip-planner-form">
                    <div class="form-group">
                        <label for="trip-city">Destino</label>
                        <input type="text" id="trip-city" placeholder="Escribe una ciudad o regi√≥n...">
                    </div>
                    <div class="form-group">
                        <label for="trip-start-date">Desde</label>
                        <input type="date" id="trip-start-date">
                    </div>
                    <div class="form-group">
                        <label for="trip-end-date">Hasta</label>
                        <input type="date" id="trip-end-date">
                    </div>
                    <button id="trip-search-btn">Buscar Eventos</button>
                </div>
                <div class="slider-container" id="trip-results-slider" style="display: none;"></div>
                <p id="trip-results-message" class="results-message" style="display: none;"></p>
            </div>
        </section>

    </main>

    <!-- Modal de Filtros Avanzados -->
    <div id="advanced-filter-modal-overlay" class="modal-overlay">
        <div class="modal">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-content">
                <h2>Filtros Avanzados</h2>
                <form id="advanced-filter-form">
                    <div class="filter-group" style="margin-bottom: 20px;">
                        <label for="modal-artist-search-input">Buscar por Artista</label>
                        <input type="text" id="modal-artist-search-input" placeholder="Escribe un artista..."
                            autocomplete="off">
                    </div>

                    <div class="filter-group" style="margin-bottom: 20px;">
                        <label for="modal-city-search-input">Buscar por Ciudad</label>
                        <div class="search-input-wrapper">
                            <input type="text" id="modal-city-search-input" placeholder="Escribe una ciudad..."
                                autocomplete="off">
                            <div id="modal-city-autocomplete-results" class="autocomplete-results"></div>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label>Filtrar por Fecha</label>
                        <div class="date-range-filter">
                            <div class="form-group">
                                <label for="modal-start-date">Desde</label>
                                <input type="date" id="modal-start-date">
                            </div>
                            <div class="form-group">
                                <label for="modal-end-date">Hasta</label>
                                <input type="date" id="modal-end-date">
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="filter-apply-btn" style="margin-top: 20px; width: 100%;">Aplicar
                        Filtros</button>
                </form>
            </div>
        </div>
    </div>

    <div id="how-it-works-modal-overlay" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="how-it-works-title">
            <button class="modal-close-btn" aria-label="Cerrar modal">&times;</button>
            <div class="modal-content">
                <h2 id="how-it-works-title"><i class="fas fa-question-circle"></i> ¬øC√≥mo funciona?</h2>
                <div id="how-it-works-text-container"></div>
                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--color-borde);">
                    <button id="clear-cache-btn" class="action-button secondary" style="width: 100%;">Limpiar Cach√© y
                        Recargar</button>
                    <p
                        style="font-size: 0.8rem; text-align: center; color: var(--color-texto-secundario); margin-top: 0.5rem;">
                        √ötil para desarrolladores para ver los √∫ltimos cambios.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Error de Geolocalizaci√≥n -->
    <div id="geolocation-error-modal-overlay" class="modal-overlay">
        <div class="modal">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-content">
                <h2 style="display: flex; align-items: center; gap: 10px;"><ion-icon name="location-outline"
                        style="font-size: 1.5rem;"></ion-icon> Permiso de Ubicaci√≥n</h2>
                <p>Has bloqueado los permisos de ubicaci√≥n. Para poder mostrarte los eventos m√°s cercanos, necesitas
                    activarlos en los ajustes de tu navegador.</p>
                <p style="font-size: 0.9rem; color: var(--color-texto-secundario);">Busca los permisos del sitio en la
                    configuraci√≥n de tu navegador y selecciona "Permitir" para la ubicaci√≥n.</p>
                <button id="retry-geolocation-btn" class="action-button primary" style="margin-top: 1rem; width: 100%;">
                    <ion-icon name="refresh-outline"></ion-icon> Reintentar Permiso
                </button>
            </div>
        </div>
    </div>

    <div id="terms-modal-overlay" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="terms-title">
            <button class="modal-close-btn" aria-label="Cerrar modal">&times;</button>
            <div class="modal-content">
                <h2 id="terms-title"><i class="fas fa-file-contract"></i> T√©rminos y Condiciones</h2>
                <div id="terms-text-container"></div>
            </div>
        </div>
    </div>
    <div id="gemini-modal-overlay" class="modal-overlay">
        <div class="modal">
            <button class="modal-close-btn">√ó</button>
            <div class="modal-content">
                <div id="gemini-modal-content"></div>
            </div>
        </div>
    </div>
    <div id="map-modal-overlay" class="modal-overlay">
        <div class="modal-content-full">
            <button id="close-map-modal-btn">&times;</button>
            <div id="modal-map-container"></div>
        </div>
    </div>
    <div id="event-detail-modal-overlay" class="modal-overlay"></div>
    <div id="image-modal-overlay" class="modal-overlay">
        <button class="modal-close-btn">&times;</button><img id="image-modal-content" src="" alt="Imagen ampliada">
    </div>
    <nav id="bottom-nav">
        <button class="nav-btn active" id="nav-home-btn" title="Inicio" aria-label="Inicio"><ion-icon
                name="home"></ion-icon></button>
        <button class="nav-btn" id="nav-how-it-works-btn" title="C√≥mo Funciona" aria-label="C√≥mo Funciona"><ion-icon
                name="help-circle-outline"></ion-icon></button>
        <button class="nav-btn" id="nav-terms-btn" title="T√©rminos" aria-label="T√©rminos y Condiciones"><ion-icon
                name="document-text-outline"></ion-icon></button>
        <button class="nav-btn" id="nav-notifications-btn" title="Notificaciones" aria-label="Notificaciones"
            data-modal-trigger="notifications-modal-overlay"><ion-icon name="notifications-outline"></ion-icon></button>
        <button class="nav-btn" id="nav-theme-toggle" title="Cambiar tema" aria-label="Cambiar tema"><ion-icon
                name="moon-outline"></ion-icon></button>
        <a href="https://afland.es" target="_blank" rel="noopener noreferrer" class="nav-btn" title="Visitar Afland.es"
            aria-label="Visitar Afland.es"><ion-icon name="flame-outline"></ion-icon></a>
    </nav>
    <script type="module" src="https://unpkg.com/ionicons@7/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7/dist/ionicons/ionicons.js"></script>
    <script type="module" src="script.js"></script>
    <script type="module" src="chatbot.js"></script>

    <!-- Search Modal Start -->
    <div id="search-modal-overlay" class="modal-overlay search-modal-overlay">
        <div class="search-modal">
            <div class="search-modal-header">
                <input type="text" id="modal-search-input" class="search-input-modal"
                    placeholder="Buscar artistas, ciudades, tablaos...">
                <button id="search-modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div id="search-results-container" class="search-results-container">
                <!-- Results will be injected here -->
            </div>
        </div>
    </div>
    <!-- Search Modal End -->

    <!-- Modal para Scroll Infinito -->
    <div class="modal-overlay" id="infinite-scroll-modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="infinite-scroll-modal-title"></h2>
                <button class="modal-close-btn" id="infinite-scroll-modal-close-btn">&times;</button>
            </div>
            <div class="modal-content" id="infinite-scroll-modal-content">
                <div class="slider-container" id="infinite-scroll-modal-slider">
                    <!-- Los eventos se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

</body>

</html>