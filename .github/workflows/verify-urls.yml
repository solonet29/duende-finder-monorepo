# .github/workflows/verify-urls.yml

name: Verificaci√≥n diaria de URLs de eventos

on:
  # Ejecuta el workflow cada d√≠a a las 5:00 AM UTC (7:00 AM en Espa√±a)
  schedule:
    - cron: '0 5 * * *'
  # Permite ejecutar este workflow manualmente desde la pesta√±a "Actions" de GitHub
  workflow_dispatch:

jobs:
  verify-urls:
    runs-on: ubuntu-latest
    
    # Establece el directorio de trabajo para todos los comandos 'run' de este job
    defaults:
      run:
        working-directory: ./apps/api

    steps:
      # 1. Obtiene el c√≥digo del repositorio
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Configura Node.js y activa el cach√© de dependencias
      - name: Set up Node.js v20 with dependency caching
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          # MEJORA: Activa el cach√© para 'npm'. Acelerar√° las instalaciones futuras.
          cache: 'npm'
          # Especificamos la ruta al package-lock.json para que el cach√© sea preciso
          cache-dependency-path: apps/api/package-lock.json

      # 3. Instala las dependencias
      - name: Install dependencies
        run: npm install

      # 4. Ejecuta el script de verificaci√≥n
      - name: Run URL verification script
        run: node verify-event-urls.js
        env:
          # Aseg√∫rate de que el Secret en GitHub se llame 'MONGODB_URI'
          MONGODB_URI: ${{ secrets.MONGO_URI }}

      # 5. Notificar en caso de fallo
      - name: Notify on failure
        if: failure()
        run: echo "üî¥ ¬°El workflow de verificaci√≥n de URLs ha fallado!"